<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Page</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
        }

        header {
            background-color: #333;
            padding: 15px;
            text-align: center;
            color: #fff;
        }

        nav {
            display: flex;
            justify-content: space-between;
            background-color: #444;
            padding: 10px;
        }
        table {
          width: 100%;
          border-collapse: collapse;
          margin-top: 20px;
        }
        th, td {
          border: 1px solid #ddd;
          padding: 8px;
          text-align: left;
        }
        th {
          background-color: #f2f2f2;
        }
    </style>
</head>

<body>
    <header>
        <h1>Admin Page</h1>
        <h4><span id="username"></span>!</h4>
    </header>
    <nav>
        <div>
            <button id="signOutB">Sign Out</button>

            <button id="makead" >Make Admin</button>  </div>

        </div>

    </nav>
    <div id="submissionForm" style="display: none;">
        <input type="text" id="dataInput" placeholder="Enter data">
        <button id="s">Submit</button>
      </div>


    <!-- <table class="table"> 
        <thead> 
            <th>Number</th>
            <th>Date</th>
            <th>Email</th>
            <th>Latitude</th>
            <th>Longitude</th>
            <th>Log In</th>
            <th>Log Out</th>
        </thead>
        <tbody id="tbody1"></tbody>
    </table> -->
    <div id="userTableContainer"></div>

    <div class="container mt-4">
        <div class="input-group mb-3">
            <input type="text" class="form-control" placeholder="Search by email" id="searchInput">
            <div class="input-group-append">
                <button class="btn btn-outline-secondary" type="button" onclick="searchTable()">Search</button>
            </div>
        </div>

        <table class="table">
            <thead>
                <th>Number</th>
                <th>Date</th>
                <th>Email</th>
                <th>Latitude</th>
                <th>Longitude</th>
                <th>Log In</th>
                <th>Log Out</th>
            </thead>
            <tbody id="tbody1"></tbody>
        </table>
    </div>


    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-firestore.js"></script>

    <script id="MainScript">
        const firebaseConfig = {
            apiKey: "AIzaSyCUZ1mxHBXoFqCYZ-LV9q2cSEBBGGa_Od8",
            authDomain: "demoapp-7d004.firebaseapp.com",
            databaseURL: "https://demoapp-7d004-default-rtdb.firebaseio.com",
            projectId: "demoapp-7d004",
            storageBucket: "demoapp-7d004.appspot.com",
            messagingSenderId: "559486024644",
            appId: "1:559486024644:web:985262b8b7330e7ea38291",
            measurementId: "G-1DST9H93L4"
        };

        firebase.initializeApp(firebaseConfig);
        let db = firebase.firestore();

        function searchTable() {
            var input, filter, table, tr, td, i, txtValue;
            input = document.getElementById("searchInput");
            filter = input.value.toUpperCase();
            table = document.getElementById("tbody1");
            tr = table.getElementsByTagName("tr");

            for (i = 0; i < tr.length; i++) {
                td = tr[i].getElementsByTagName("td")[2]; // Change the index to match the column you want to search
                if (td) {
                    txtValue = td.textContent || td.innerText;
                    if (txtValue.toUpperCase().indexOf(filter) > -1) {
                        tr[i].style.display = "";
                    } else {
                        tr[i].style.display = "none";
                    }
                }
            }
        }

        function getAllData() {
            db.collection("users").get().then((querySnapshot) => {
                var users = [];
                querySnapshot.forEach((doc) => {
                    users.push(doc.data());
                });
        
                // Sort the users array by date
                users.sort((a, b) => {
                    // Assuming that date is in the format "YYYY-MM-DD", adjust the comparison logic based on your actual data structure
                    return new Date(a.date) - new Date(b.date);
                });
        
                addAllItemsToTheTable(users);
            });
        }
        
        

        function addAllItemsToTheTable(userList) {
            var stdNo = 0;
            var tbody = document.getElementById('tbody1');
            tbody.innerHTML = "";

            userList.forEach((user) => {
                AddItemToTable(++stdNo, user.date, user.email, user.location.latitude, user.location.longitude, user.log_in, user.log_out);
            });
        }

        function AddItemToTable(number, date, email, latitude, longitude, logIn, logOut) {
            let trow = document.createElement("tr");
            let td1 = document.createElement("td");
            let td2 = document.createElement("td");
            let td3 = document.createElement("td");
            let td4 = document.createElement("td");
            let td5 = document.createElement("td");
            let td6 = document.createElement("td");
            let td7 = document.createElement("td");

            td1.innerHTML = number;
            td2.innerHTML = date;
            td3.innerHTML = email;
            td4.innerHTML = latitude;
            td5.innerHTML = longitude;
            td6.innerHTML = logIn;
            td7.innerHTML = logOut;

            trow.appendChild(td1);
            trow.appendChild(td2);
            trow.appendChild(td3);
            trow.appendChild(td4);
            trow.appendChild(td5);
            trow.appendChild(td6);
            trow.appendChild(td7);

            document.getElementById('tbody1').appendChild(trow);
        }

        window.onload = getAllData;
    </script>

    <script type="module" src="./page_script.js"></script>

    <!-- <script type ="module" src="./admin.js"></script> -->

</body>

</html>
